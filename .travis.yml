sudo: required

env:
  global:
    - KUBECTL_VERSION=v1.13.0
    - KIND_VERSION=0.1.0
    - KIND_CLUSTER=es-e2e

services:
  - docker

before_script:
  # Install kubectl.
  - curl -Lo kubectl https://storage.googleapis.com/kubernetes-release/release/${KUBECTL_VERSION}/bin/linux/amd64/kubectl && chmod +x kubectl && sudo mv kubectl /usr/local/bin/
  # Download and install KinD
  - curl -Lo kind https://github.com/kubernetes-sigs/kind/releases/download/${KIND_VERSION}/kind-linux-amd64 && chmod +x kind && sudo mv kind /usr/local/bin/

script: make KIND_CLUSTER=${KIND_CLUSTER}

deploy:
- provider: script
  skip_cleanup: true
  script: make release
  on:
    tags: true
