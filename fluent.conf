<source>
  @type forward
  bind 0.0.0.0
  port 24224
</source>

<match kubernetes.**>
  @type rewrite_tag_filter
  <rule>
    key $['kubernetes']['labels']['app']
    pattern ^(.+)$
    tag $1.{{ .Values.global.cluster }}
  </rule>
</match>

<match **>
  @id elasticsearch
  @type elasticsearch
  @log_level info
  include_tag_key true
  host elasticsearch
  port 9200
  logstash_prefix ${tag}
  <buffer>
    @type file
    path /fluentd/log/elasticsearch.all.buffer
    flush_mode interval
    flush_interval 5s
    flush_thread_count 3
    retry_max_interval 60
    retry_forever
    retry_type exponential_backoff
    chunk_limit_size 2m
    queue_limit_length 64
    overflow_action block
  </buffer>
</match>

<match fluent_bit>
  @type stdout
</match>

<source>
  @type prometheus
  port 24231
</source>

<source>
  @type prometheus_monitor
</source>

<source>
  @type prometheus_output_monitor
</source>
